[
    {
        "id": "ef8f9b32dc650502",
        "type": "tab",
        "label": "Test",
        "disabled": false,
        "info": "",
        "env": []
    },
    {
        "id": "2f28686888d6bd2a",
        "type": "chatbot-telegram-node",
        "botname": "ITKI_bot",
        "usernames": "",
        "polling": "100",
        "store": "",
        "log": "",
        "debug": true,
        "skipMediaFiles": false,
        "webHook": "",
        "connectMode": "polling",
        "storeMessages": true,
        "enableMissionControl": false,
        "inspectMessages": true,
        "chatbotId": ""
    },
    {
        "id": "d8f1225757fcd093",
        "type": "chatbot-telegram-receive",
        "z": "ef8f9b32dc650502",
        "bot": "2f28686888d6bd2a",
        "botProduction": "",
        "x": 150,
        "y": 620,
        "wires": [
            [
                "11299c98bba5c8d0",
                "d5db58cbad6ccb63"
            ]
        ]
    },
    {
        "id": "6bc1c3172ea348be",
        "type": "chatbot-telegram-send",
        "z": "ef8f9b32dc650502",
        "bot": "2f28686888d6bd2a",
        "botProduction": "",
        "track": false,
        "passThrough": false,
        "errorOutput": false,
        "outputs": 0,
        "x": 1200,
        "y": 660,
        "wires": []
    },
    {
        "id": "11299c98bba5c8d0",
        "type": "debug",
        "z": "ef8f9b32dc650502",
        "name": "inbound message",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 350,
        "y": 540,
        "wires": []
    },
    {
        "id": "846cbba6d24c7182",
        "type": "chatbot-telegram-menu",
        "z": "ef8f9b32dc650502",
        "bot": "2f28686888d6bd2a",
        "items": [
            {
                "command": "/help",
                "description": "Відповіді на часті запитання"
            },
            {
                "command": "/where_is",
                "description": "Знайти розташування аудитоорії по номеру"
            },
            {
                "command": "/curator",
                "description": "Знайти куратора по номеру групи"
            },
            {
                "command": "/schedule",
                "description": "Отримати останній розклад ФІТ"
            }
        ],
        "x": 300,
        "y": 300,
        "wires": []
    },
    {
        "id": "9bbda5ba0781f72e",
        "type": "inject",
        "z": "ef8f9b32dc650502",
        "name": "",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": true,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 130,
        "y": 300,
        "wires": [
            [
                "846cbba6d24c7182"
            ]
        ]
    },
    {
        "id": "d5db58cbad6ccb63",
        "type": "chatbot-rules",
        "z": "ef8f9b32dc650502",
        "name": "",
        "rules": [
            {
                "type": "command",
                "command": "/where_is"
            },
            {
                "type": "command",
                "command": "/help"
            },
            {
                "type": "command",
                "command": "/curator"
            },
            {
                "type": "command",
                "command": "/schedule"
            },
            {
                "type": "command",
                "command": "/start"
            },
            {
                "type": "notMessageType",
                "messageType": "command"
            },
            {
                "type": "catchAll"
            }
        ],
        "outputs": 7,
        "x": 390,
        "y": 620,
        "wires": [
            [
                "0ec9e83584699c2b"
            ],
            [
                "9601e27c5c08ab08"
            ],
            [],
            [
                "bcbf3adc5918dcb6"
            ],
            [
                "6207f6baa19bfda1"
            ],
            [
                "20a71a061e8c5f20"
            ],
            [
                "a8559b57b8d3879f"
            ]
        ]
    },
    {
        "id": "ef41fc39b74f7085",
        "type": "chatbot-message",
        "z": "ef8f9b32dc650502",
        "name": "",
        "message": [
            {
                "message": "Введи номер аудиторії (поки підтримується тільки корпус 7)"
            }
        ],
        "language": "none",
        "x": 210,
        "y": 1160,
        "wires": [
            [
                "b8cc7e425cdc6abf"
            ]
        ]
    },
    {
        "id": "b8cc7e425cdc6abf",
        "type": "chatbot-telegram-send",
        "z": "ef8f9b32dc650502",
        "bot": "2f28686888d6bd2a",
        "botProduction": "",
        "track": true,
        "passThrough": false,
        "errorOutput": false,
        "outputs": 1,
        "x": 370,
        "y": 1160,
        "wires": [
            [
                "9acfe5a74488b916"
            ]
        ]
    },
    {
        "id": "9acfe5a74488b916",
        "type": "chatbot-parse",
        "z": "ef8f9b32dc650502",
        "name": "",
        "parseType": "number-integer",
        "parseVariable": "cabinet",
        "x": 580,
        "y": 1160,
        "wires": [
            [
                "de9e296e576e16d9"
            ],
            [
                "ef0fd14b9f699474"
            ]
        ]
    },
    {
        "id": "6207f6baa19bfda1",
        "type": "chatbot-message",
        "z": "ef8f9b32dc650502",
        "name": "welcome message",
        "message": [
            {
                "message": "Привіт! Я твій особистий помічник ITKI-bot. Ознайомся з командами які я можу виконати натиснувши /"
            }
        ],
        "language": "none",
        "x": 630,
        "y": 680,
        "wires": [
            [
                "cf32863c571a6118"
            ]
        ]
    },
    {
        "id": "14dcac47d6fa8938",
        "type": "function",
        "z": "ef8f9b32dc650502",
        "name": "find floor",
        "func": "msg.floor = Math.floor(msg.chat().get('cabinet') / 100);\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 960,
        "y": 1120,
        "wires": [
            [
                "d97158d544f83b7c"
            ]
        ]
    },
    {
        "id": "de9e296e576e16d9",
        "type": "switch",
        "z": "ef8f9b32dc650502",
        "name": "is valid number",
        "property": "msg.chat().get('cabinet')",
        "propertyType": "jsonata",
        "rules": [
            {
                "t": "gte",
                "v": "100",
                "vt": "num"
            },
            {
                "t": "else"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 780,
        "y": 1140,
        "wires": [
            [
                "14dcac47d6fa8938"
            ],
            [
                "ef0fd14b9f699474"
            ]
        ]
    },
    {
        "id": "ef0fd14b9f699474",
        "type": "chatbot-message",
        "z": "ef8f9b32dc650502",
        "name": "invalid number",
        "message": [
            {
                "message": "Було введено не правильний номер кабінету. Виконай команду /where_is знов"
            }
        ],
        "language": "none",
        "x": 960,
        "y": 1200,
        "wires": [
            [
                "b652a5b7ed33e00c"
            ]
        ]
    },
    {
        "id": "d97158d544f83b7c",
        "type": "chatbot-message",
        "z": "ef8f9b32dc650502",
        "name": "Answer",
        "message": [
            {
                "message": "Аудиторія знаходиться у 7 корпусі на {{floor}} поверсі"
            }
        ],
        "language": "none",
        "x": 1140,
        "y": 1120,
        "wires": [
            [
                "b96b9e7155c9a0da"
            ]
        ]
    },
    {
        "id": "a8559b57b8d3879f",
        "type": "chatbot-ask",
        "z": "ef8f9b32dc650502",
        "name": "remove buttons and send error",
        "buttons": [],
        "message": "Невідома команда ",
        "x": 670,
        "y": 780,
        "wires": [
            [
                "4e6ba142399aabc8"
            ]
        ]
    },
    {
        "id": "9601e27c5c08ab08",
        "type": "function",
        "z": "ef8f9b32dc650502",
        "name": "set buttons",
        "func": "const questions = Object.keys(flow.get(\"questions\"));\nlet buttons = [];\nfor (let i = 0; i < questions.length; i++) {\n    buttons.push({ type: 'newline' });\n    buttons.push({ type: 'keyboardButton', label: questions[i] });\n}\nmsg.payload = { \n    \"type\": \"buttons\",\n    \"content\": \"Вибери питання на яке хочеш отримати відповідь\",\n    \"chatId\": msg.payload.chatId,\n    \"buttons\": buttons\n    }\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 610,
        "y": 580,
        "wires": [
            [
                "60263b02fe0a7c71"
            ]
        ]
    },
    {
        "id": "e5df729bd1882412",
        "type": "inject",
        "z": "ef8f9b32dc650502",
        "name": "",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "600",
        "crontab": "",
        "once": true,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 130,
        "y": 420,
        "wires": [
            [
                "584daa1703e4fb13"
            ]
        ]
    },
    {
        "id": "584daa1703e4fb13",
        "type": "function",
        "z": "ef8f9b32dc650502",
        "name": "set data",
        "func": "msg.questions = {\n    \"a\":\"a1\",\n    \"b\":\"b1\",\n    \"c\":\"c1\"\n};\nmsg.schedule = \"https://www.nmu.org.ua/ua/content/student_life/students/schedule/rasps/sched_fit_2%20sem_2023.xls\";\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 320,
        "y": 420,
        "wires": [
            [
                "9eee9774e7dd440e"
            ]
        ]
    },
    {
        "id": "9eee9774e7dd440e",
        "type": "change",
        "z": "ef8f9b32dc650502",
        "name": "set to flow",
        "rules": [
            {
                "t": "set",
                "p": "questions",
                "pt": "flow",
                "to": "questions",
                "tot": "msg",
                "dc": true
            },
            {
                "t": "set",
                "p": "schedule",
                "pt": "flow",
                "to": "schedule",
                "tot": "msg",
                "dc": true
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 550,
        "y": 420,
        "wires": [
            [
                "7d3695e449ad3bb6"
            ]
        ]
    },
    {
        "id": "67adf457139ad431",
        "type": "link in",
        "z": "ef8f9b32dc650502",
        "name": "/telegramSeder",
        "links": [
            "60263b02fe0a7c71",
            "4e6ba142399aabc8",
            "cf32863c571a6118",
            "b96b9e7155c9a0da",
            "b652a5b7ed33e00c",
            "2beae5b7bba77a81",
            "4d98901a1e6fbe96"
        ],
        "x": 1035,
        "y": 660,
        "wires": [
            [
                "6bc1c3172ea348be"
            ]
        ]
    },
    {
        "id": "60263b02fe0a7c71",
        "type": "link out",
        "z": "ef8f9b32dc650502",
        "name": "link out 1",
        "mode": "link",
        "links": [
            "67adf457139ad431",
            "3ee8ad858222412f"
        ],
        "x": 745,
        "y": 580,
        "wires": []
    },
    {
        "id": "4e6ba142399aabc8",
        "type": "link out",
        "z": "ef8f9b32dc650502",
        "name": "link out 2",
        "mode": "link",
        "links": [
            "67adf457139ad431",
            "3ee8ad858222412f"
        ],
        "x": 885,
        "y": 780,
        "wires": []
    },
    {
        "id": "cf32863c571a6118",
        "type": "link out",
        "z": "ef8f9b32dc650502",
        "name": "link out 3",
        "mode": "link",
        "links": [
            "67adf457139ad431",
            "3ee8ad858222412f"
        ],
        "x": 855,
        "y": 680,
        "wires": []
    },
    {
        "id": "b96b9e7155c9a0da",
        "type": "link out",
        "z": "ef8f9b32dc650502",
        "name": "link out 4",
        "mode": "link",
        "links": [
            "67adf457139ad431",
            "3ee8ad858222412f"
        ],
        "x": 1245,
        "y": 1120,
        "wires": []
    },
    {
        "id": "b652a5b7ed33e00c",
        "type": "link out",
        "z": "ef8f9b32dc650502",
        "name": "link out 5",
        "mode": "link",
        "links": [
            "67adf457139ad431",
            "3ee8ad858222412f"
        ],
        "x": 1105,
        "y": 1200,
        "wires": []
    },
    {
        "id": "ab0e068ac6c0b1cb",
        "type": "comment",
        "z": "ef8f9b32dc650502",
        "name": "set data to env flow",
        "info": "",
        "x": 130,
        "y": 260,
        "wires": []
    },
    {
        "id": "d5d427bdd19a2e0a",
        "type": "comment",
        "z": "ef8f9b32dc650502",
        "name": "set menu",
        "info": "",
        "x": 100,
        "y": 380,
        "wires": []
    },
    {
        "id": "c0ef40219fc3b113",
        "type": "comment",
        "z": "ef8f9b32dc650502",
        "name": "handle message ",
        "info": "",
        "x": 120,
        "y": 480,
        "wires": []
    },
    {
        "id": "4925551eac952776",
        "type": "comment",
        "z": "ef8f9b32dc650502",
        "name": "handle button",
        "info": "",
        "x": 90,
        "y": 1440,
        "wires": []
    },
    {
        "id": "45b28a3dcc0e4f26",
        "type": "switch",
        "z": "ef8f9b32dc650502",
        "name": "is right button",
        "property": "isRight",
        "propertyType": "msg",
        "rules": [
            {
                "t": "true"
            },
            {
                "t": "else"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 600,
        "y": 1500,
        "wires": [
            [
                "0005f3de40515888"
            ],
            [
                "cf3b71e5c6f781ea"
            ]
        ]
    },
    {
        "id": "20a71a061e8c5f20",
        "type": "link out",
        "z": "ef8f9b32dc650502",
        "name": "link out 6",
        "mode": "link",
        "links": [
            "a8bb9967c68c74c2"
        ],
        "x": 555,
        "y": 720,
        "wires": []
    },
    {
        "id": "a8bb9967c68c74c2",
        "type": "link in",
        "z": "ef8f9b32dc650502",
        "name": "/handleButton",
        "links": [
            "20a71a061e8c5f20",
            "262204abeb1fbbf8"
        ],
        "x": 105,
        "y": 1500,
        "wires": [
            [
                "fc7f91448ed5ce03"
            ]
        ]
    },
    {
        "id": "2beae5b7bba77a81",
        "type": "link out",
        "z": "ef8f9b32dc650502",
        "name": "link out 7",
        "mode": "link",
        "links": [
            "67adf457139ad431",
            "3ee8ad858222412f"
        ],
        "x": 1125,
        "y": 1500,
        "wires": []
    },
    {
        "id": "fc7f91448ed5ce03",
        "type": "function",
        "z": "ef8f9b32dc650502",
        "name": "is right Button",
        "func": "msg.isRight = Object.keys(flow.get(\"questions\")).includes(msg.payload.content);\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 320,
        "y": 1500,
        "wires": [
            [
                "45b28a3dcc0e4f26"
            ]
        ]
    },
    {
        "id": "7d3695e449ad3bb6",
        "type": "debug",
        "z": "ef8f9b32dc650502",
        "name": "set quetions",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 750,
        "y": 360,
        "wires": []
    },
    {
        "id": "cf3b71e5c6f781ea",
        "type": "chatbot-ask",
        "z": "ef8f9b32dc650502",
        "name": "remove buttons and send error",
        "buttons": [],
        "message": "На це питання я не знаю відповіді, виконай команду /help, щоб переглянути поточний список питань",
        "x": 870,
        "y": 1540,
        "wires": [
            [
                "2beae5b7bba77a81"
            ]
        ]
    },
    {
        "id": "0005f3de40515888",
        "type": "function",
        "z": "ef8f9b32dc650502",
        "name": "send answer",
        "func": "msg.payload = { \n    \"type\": \"message\",\n    \"content\": flow.get(\"questions\")[msg.payload.content],\n    \"chatId\": msg.payload.chatId,\n    \"inbound\": false,\n    \"fallback\": null \n};\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 830,
        "y": 1480,
        "wires": [
            [
                "2beae5b7bba77a81"
            ]
        ]
    },
    {
        "id": "0ec9e83584699c2b",
        "type": "link out",
        "z": "ef8f9b32dc650502",
        "name": "link out 8",
        "mode": "link",
        "links": [
            "05887e897f7af058"
        ],
        "x": 485,
        "y": 560,
        "wires": []
    },
    {
        "id": "05887e897f7af058",
        "type": "link in",
        "z": "ef8f9b32dc650502",
        "name": "/where_is",
        "links": [
            "0ec9e83584699c2b",
            "22d93b6af0e3e632"
        ],
        "x": 85,
        "y": 1160,
        "wires": [
            [
                "ef41fc39b74f7085"
            ]
        ]
    },
    {
        "id": "999e3fc17ebd6627",
        "type": "comment",
        "z": "ef8f9b32dc650502",
        "name": "where is",
        "info": "",
        "x": 120,
        "y": 1080,
        "wires": []
    },
    {
        "id": "fbc920e4941c6344",
        "type": "link in",
        "z": "ef8f9b32dc650502",
        "name": "/schedule",
        "links": [
            "bcbf3adc5918dcb6"
        ],
        "x": 95,
        "y": 980,
        "wires": [
            [
                "c02552101f3f29d3"
            ]
        ]
    },
    {
        "id": "bcbf3adc5918dcb6",
        "type": "link out",
        "z": "ef8f9b32dc650502",
        "name": "link out 9",
        "mode": "link",
        "links": [
            "fbc920e4941c6344"
        ],
        "x": 535,
        "y": 640,
        "wires": []
    },
    {
        "id": "745548923030d516",
        "type": "chatbot-document",
        "z": "ef8f9b32dc650502",
        "name": "send schedule",
        "filename": "",
        "document": "https://www.nmu.org.ua/ua/content/student_life/students/schedule/rasps/sched_fit_2%20sem_2023.xls",
        "caption": "Розклад",
        "x": 460,
        "y": 1060,
        "wires": [
            []
        ]
    },
    {
        "id": "4d98901a1e6fbe96",
        "type": "link out",
        "z": "ef8f9b32dc650502",
        "name": "link out 10",
        "mode": "link",
        "links": [
            "67adf457139ad431",
            "3ee8ad858222412f"
        ],
        "x": 625,
        "y": 980,
        "wires": []
    },
    {
        "id": "c02552101f3f29d3",
        "type": "change",
        "z": "ef8f9b32dc650502",
        "name": "set schedule",
        "rules": [
            {
                "t": "set",
                "p": "schedule",
                "pt": "msg",
                "to": "schedule",
                "tot": "flow",
                "dc": true
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 230,
        "y": 980,
        "wires": [
            [
                "f015a4dc71559b8d"
            ]
        ]
    },
    {
        "id": "f015a4dc71559b8d",
        "type": "chatbot-message",
        "z": "ef8f9b32dc650502",
        "name": "",
        "message": [
            {
                "message": "https://www.nmu.org.ua/ua/content/student_life/students/schedule/rasps/sched_fit_2%20sem_2023.xls"
            }
        ],
        "language": "none",
        "x": 430,
        "y": 980,
        "wires": [
            [
                "4d98901a1e6fbe96"
            ]
        ]
    }
]